class UserBind{self;constructor(e,s){this.send_user_id=e,this.rec_user_id=s,self=this,this.socket=io("http://localhost:5000",{transports:["websocket","polling","flashsocket"]}),this.getdata()}getdata(){let e=this;this.socket.on("connect",(function(){e.socket.emit("join_room",{chatroom:self.send_user_id})})),$.ajax({url:"/chat/getchat",method:"POST",success:this.displaychat,data:{toUser:this.rec_user_id}}),this.socket.on("new-message",(function(e){$("#chatarea h1").attr("data")==e.from_user&&($("#chat-list").append(`<li class="other-message"><span>${e.message}</span></li>`),$("#chat-list").scrollTop($("#chat-list")[0].scrollHeight))})),this.socket.on("delete-message",(function(e){$(`#message-${e.messageid}`).remove()}))}displaychat(e){$("#chatarea").html(`\n        <h1 data="${e.data.receiveuser.id}"> ${e.data.receiveuser.name} </h1>\n        <ul id ="chat-list">\n        </ul>\n        <div id="messagebox-container">\n            <input id="new_message" type="text">\n            <button>\n                <i class="fa-solid fa-paper-plane"></i>\n            </button>\n        </div>\n        `);for(let s of e.data.chat.messages)s.from_user==self.rec_user_id?$("#chat-list").append(`<li id="message-${s._id}" class="other-message"><span>\n                    ${s.content}\n                </span></li>`):$("#chat-list").append(`<li id="message-${s._id}" class="self-message"><span>\n                    <i id="${s._id}" class="delete-message-button fa-regular fa-circle-xmark"></i>\n                    ${s.content}\n                </span></li>`);$("#chat-list").scrollTop($("#chat-list")[0].scrollHeight),$("#chatarea button").attr("id","send-message-button"),$("#send-message-button").on("click",(function(e){let s=$("#chatarea h1").attr("data"),t=$("#new_message").val();""!=t&&$.ajax({url:"/chat/send_message",method:"POST",success:self.createMessage,data:{to_user_id:s,message:t}})})),$(".delete-message-button").click((function(e){let s=$(e.target).attr("id");$.ajax({url:`/chat/delete_message/${s}`,method:"GET",success:function(e){$(`#message-${s}`).remove(),self.socket.emit("delete-message",{messageid:s,from_user:self.send_user_id,to_user:self.rec_user_id})}})}))}createMessage(e){$("#chat-list").append(`<li id="message-${e.message._id}" class="self-message"><span>\n        <i id="${e.message._id}" class="delete-message-button fa-regular fa-circle-xmark"></i>\n            ${e.message.content}\n        </span></li>`),$("#new_message").val(""),$("#chat-list").scrollTop($("#chat-list")[0].scrollHeight),self.socket.emit("send-message",{from_user:self.send_user_id,to_user:self.rec_user_id,message:e.message.content}),$(`#${e.message._id}`).click((function(e){let s=$(e.target).attr("id");$.ajax({url:`/chat/delete_message/${s}`,method:"GET",success:function(e){$(`#message-${s}`).remove(),self.socket.emit("delete-message",{messageid:s,from_user:self.send_user_id,to_user:self.rec_user_id})}})}))}}$(".friends").on("click",(function(e){e.preventDefault();let s=$(this).attr("href"),t=$("#chatarea").attr("from_user");new UserBind(t,s)}));